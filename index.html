<!DOCTYPE html>
<html>

<body>
    <canvas id="game" width="800" height="600"></canvas>
</body>

<script>

    class Block {
        static blocks = []
        constructor(x, y, color, ctx) {
            this.x = x
            this.y = y
            this.color = color
            this.ctx = ctx
            this.block = null

            Block.blocks.push(this)
        }

        render() {
            this.ctx.fillStyle = this.color
            this.ctx.fillRect(this.x, this.y, squareSize, squareSize);
        }

        collisionWith() {
            if (player.x === this.x - squareSize && player.y > this.y - squareSize) {

                player.color = "blue"
                player.block = "right"
                return
            }

            if (player.x === this.x + squareSize && player.y > this.y - squareSize) {

                player.color = "blue"
                player.block = "left"
                return
            }

            if (player.x == this.x && player.y >= this.y - squareSize) {

                player.color = "blue"
                player.block = "top"
                player.startJumpTime = 0
                player.y = this.y - squareSize
                return
            }

            player.color = "yellow"
            player.block = null
        }

        static renderAll() {
            for (const block of Block.blocks) {

                block.render()
            }
        }

        static collision(player) {
            for (const block of Block.blocks) {

                block.collisionWith(player)
            }
        }
    }

    class Player {

        constructor(x, y, color, ctx) {
            this.x = x
            this.y = y
            this.color = color
            this.ctx = ctx
            this.startJumpTime = 0

        }

        render() {
            this.ctx.fillStyle = this.color
            this.ctx.fillRect(this.x, this.y, squareSize, squareSize);
        }

        jump(time) {
            if (this.startJumpTime !== 0) {

                this.y -= (time - this.startJumpTime) / 40 - (time - this.startJumpTime) * (time - this.startJumpTime) / 40000
            }

            if (this.y > screenHeight - 2 * squareSize) {
                this.y = screenHeight - 2 * squareSize
                this.startJumpTime = 0
            }
        }

    }

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const screenWidth = 800
    const screenHeight = 600

    let time = 0

    const squareSize = 20;
    let keysPressed = {}

    new Block(200, screenHeight - 2 * squareSize, 'red', ctx)
    new Block(400, screenHeight - 2 * squareSize, 'red', ctx)
    new Block(300, screenHeight - 4 * squareSize, 'red', ctx)

    const player = new Player(0, 560, 'yellow', ctx)

    function renderBackground() {
        ctx.fillStyle = "green";
        ctx.fillRect(0, 0, screenWidth, screenHeight);

        ctx.fillStyle = "red";
        ctx.fillRect(0, screenHeight - squareSize, screenWidth, squareSize);
    }

    function renderTime() {
        ctx.font = '20px serif';
        ctx.fillText('The game of adventure ' + time, 10, 20);
        ctx.fillText(player.x + "/" + player.y, 10, 40);
        ctx.fillText(Block.blocks[0].x + "/" + Block.blocks[0].y, 10, 60);
    }

    function render() {
        checkCollision()
        renderBackground()
        Block.renderAll()
        player.render()
        renderTime()

    }

    function checkCollision() {
        Block.collision(player)
    }

    function loop() {
        setInterval(() => {
            update(time)
            render()
            time += 50
        }, 50)
    }

    function update(time) {
        processKeys()
        player.jump(time)
    }


    function processKeys() {
        if (keysPressed[37] && player.block !== "left") {
            player.x -= squareSize
            if (player.x < 0) {
                player.x = 0
            }
        }
        if (keysPressed[39] && player.block !== "right") {
            player.x += squareSize
        }

        if (keysPressed[38] && player.startJumpTime === 0) {
            player.startJumpTime = time
        }
    };

    document.addEventListener('keydown', (event) => {
        keysPressed[event.keyCode] = true;
        // console.log('keydown', keysPressed)
    });

    document.addEventListener('keyup', (event) => {
        delete keysPressed[event.keyCode];
        // console.log('keyup', keysPressed)
    });


    loop()

</script>

</html>